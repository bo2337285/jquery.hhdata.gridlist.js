<!DOCTYPE html>
<html>
<head>
	<title></title>
	<meta charset="UTF-8">
	<link rel="stylesheet" type="text/css" href="../src/jquery.hhdata.gridlist.css">
	<link rel="stylesheet" type="text/css" href="jquery.qtip.css">
	<link rel="stylesheet" type="text/css" href="hhdata-base.css">
	<link rel="stylesheet" type="text/css" href="font-Awesome/css/font-awesome.min.css">
</head>
<body>
<!--/*
*	属性阐释
*	#td：
*		data-sort:是否排序;
*		data-name:展示数据key
*		data-sourcekey:排序数据key
*		data-show:是否显示该列
*		data-align:文字对齐方式
*   data-dragable
*		width:列宽
*	#dd:
*		data-source:排序参考数据
*
*/
-->

<table id="grid" class="grid-source">
      <tr>
      	<td data-sort="true" data-extkey="name" data-extfmt="true" data-number="true" data-align="center" data-name="number">序号</td>
      	<td data-sort="true"  data-dragable data-name="color" data-sourcekey="upByteStr" data-hide="true" data-align="left" data-width="80" ><a href="###">数据0</a></td>
      	<td data-sort="false"  data-dragable data-name="dnByteStr" data-sourcekey="upByteStr"  data-align="center" >数据1</td>
      	<td data-fomatter="fmtIcon" data-width="120" data-dragable data-name="icon" data-align="center" >灯</td>
      	<td data-sort="false"   data-dragable data-name="dnMaxBpsStr" data-sourcekey="upByteStr"  data-align="right" data-width="60" >数据2</td>
      	<td data-sort="true"   data-dragable data-name="dnPassByteStr" data-sourcekey="upByteStr"  data-align="center" data-width="220" >数据3</td>
      	<td data-sort="false"   data-dragable data-name="dnMinBpsStr" data-sourcekey="upByteStr"  data-align="center" data-width="70" >数据3</td>
      	<td data-sort="false"   data-dragable data-name="maxBpsStr" data-sourcekey="upByteStr"  data-align="center" data-width="70" >数据3</td>
      	<td data-sort="false"   data-dragable data-name="minBpsStr" data-sourcekey="upByteStr"  data-align="center" data-width="70" >数据3</td>
      	<td data-sort="false"   data-dragable data-name="name" data-sourcekey="upByteStr"  data-align="center" data-width="70" >数据3</td>
      	<td data-sort="false" data-dragable data-name="totalBpsStr.aa.bb.cc[1]" data-extfmt="true" data-sourcekey="upByteStr"  data-align="center" data-width="70" data-fomatter="fomatterOperaCol">数据a</td>
      	<td data-opera="true" data-operakey="opera0" data-align="center">操作列0</td>
        <td data-opera="true" data-operakey="opera1" data-align="center">操作列1</td>
      </tr>
</table>
<div id="gridTitle"  >a</div>
<script src="../lib/jquery-1.10.2.js"></script>
<script src="../src/jquery.hhdata.gridlist.js"></script>
<script src="../lib/tinysort.min.js"></script>
<script src="jquery.mockjax.js"></script>
<script src="jquery.qtip.js"></script>
<script>
var fakeData ={
			"result": 1,
			"mstList": [],
			"sumList":[],
			"log": "操作成功"
	}
	var getData = function () {
		var o = {
			"color": "<a href='###'>C6E579</a>",
			"dnByteStr": "0.465",
			"dnDisByteStr": "0.046",
			"dnMaxBpsStr": "0.021",
			"dnMinBpsStr": "0.000",
			"dnPassByteStr":"",
			"icon" : [
				{
					"color":"red",
					"state":true,
					"info":"红灯"
				}
			],
			"id": 12,
			"indexStr": "1",
			"maxBpsStr": "0.043",
			"minBpsStr": "0.000",
			"name": "汇总",
			"totalBpsStr": {"aa":{"bb":{"cc":["aa","bb"]}}},
			"totalByteStr": "0.930",
			"totalPassByteStr": "0.837",
			"totalPassPerStr": "90.0",
			"totalPerStr": "6.9",
			"upByteStr": Math.random(),
			"upDisByteStr": "0.046",
			"upMaxBpsStr": "0.021",
			"upMinBpsStr": "0.000",
			"upPassByteStr": "0.418"
		};
		o["indexStr"]  = Math.random()>0.5;
		o["dnPassByteStr"] = o["upByteStr"];
		o['dnByteStr'] =  o["upByteStr"];
		o['maxBpsStr'] =   Math.abs(Math.random()*10).toFixed(Math.abs(Math.random()*10));
		o['icon'] = (function (argument) {
			var idx = Math.abs(Math.random()*10),list=[],colorList = ['red','green','blue','yellow'];
			for (var i = 0; i < idx; i++) {
				var color = colorList[Math.round(Math.random()*3)]
				list.push({
					"color":color,
					"state":true,
					"info":"描述"+color
				})
			}
			return list;
		})()
		return o;
	}
	for (var i = 0; i < 100; i++) {
		fakeData["mstList"].push(getData())
	};
	var fakeRes = {data:fakeData["mstList"].slice(0,20),dataTotal:1000}
// mock data
	$.mockjax({
			url: 'loadData',
			response:function (settings) {
				var param = settings.data,
						cpage = param.currentPage,
						pageSize = param.pageSize,
						total = 72,
						size = Math.min(total-pageSize*(cpage-1),pageSize),
						list = [];
				for (var i = 0; i < size; i++) {
					list.push(getData());
				}
				var res = {
				    "result": 1,
				    "pagination": {
				        "dataTotal": 72,
				        "list": list,
				        "pageNumber": cpage
				    },
				    "log": "操作成功"
				}
				this.responseText = res;
			}
		});
function fomatterOperaCol(value,$td,rowData){
  var $btn = $("<a href='javascript:;'>"+value+"</a>")
  $btn[0].oncontextmenu = function () {return false; } //禁用右键
  return $btn;
}

function fmtIcon(iconList,$td,rowData) {
	 $td.qtip({
	 	content : renderTipInfo(iconList),
		position : {my:"left center",at:"right center",adjust: { target: $(document), resize: true,method:"flipinvert"  }},
		hide: {fixed: true,delay: 300}
	 })
	var str = "";
	var len = iconList.length;
	if(len > 4){
		var splitIdx = Math.round(len/2);
		str += "<div style='line-height: 14px;text-align: center;'>";
		str += loopIcon(iconList.slice(0,splitIdx));
		str += "</div><div style='line-height: 14px;text-align: center;'>";
		str += loopIcon(iconList.slice(splitIdx));
	}else{
		str += "<div style='text-align: center;'>";
		str += loopIcon(iconList);
	}
	str += "</div>"
	return str;
}

function loopIcon(iconList) {
	var str = "";
	$.each(iconList,function (i,icon) {
		str += renderIcon(icon);
	})
	return str;
}

function renderTipInfo(iconList) {
	var str = "<div class='qtip-list-content'><ul style='list-style:none;padding-left:0;' class='qtip-list-ul'>";
	$.each(iconList,function (i,icon) {
		str += "<li>"
		str += renderIcon(icon)
		str += icon.info
		str += "</li>"
	})
	str += "</ul></div>"
	return str;
}

function renderIcon(icon) {
	var color = "";
	switch (icon.color) {
		case "red":
		color = "#e54957";
			break;
		case "blue":
		color = "#5086de"
			break;
		case "green":
		color = "#4cc17b"
			break;
		case "yellow":
		color = "#FFA500"
			break;
		default:
			break;
	}
	return "<span class='icon-circle icon-m-r' style ='color:"+color+"'></span>"
}

function fmtStr(value,$td,rowData) {
	return value+"MB";
}
	$(function(){
		var t1 = new Date().getTime()
		g = $("#grid").gridList({
                  // width:400,
                  height:400,
                  title:$('#gridTitle'),
                  table:{
                        data:fakeData["mstList"],
												// url:'loadData',
                        checkbox:true,
												loadMode:"local_page_load",
                        // loadMode:"url_page_post",
                        //fullMode:true,
                        checkboxName:"indexStr"
                  },
                  extTable:{
                  		data:[fakeData["mstList"][0]]
                  },
                  fixedTable:{
                       fixedColName:['number',"totalBpsStr.aa.bb.cc[1]","dnByteStr"]
                  },
									page:{
											pageSize:50
									}
            })
		var t2 = new Date().getTime()
		console.log(t2-t1)
	})

</script>
</body>
</html>
